# Dify導入トレーニング - 1日目午後
## Docker・Kubernetes入門（Dify構築準備）

---

## 📋 午後の学習目標

この時間の終わりまでに、以下のことができるようになります：
- DockerとKubernetesが何かを説明できる
- なぜDifyでDockerが必要なのかを理解する
- 明日のハンズオンで必要な基本用語を覚える
- Docker Desktopの基本操作ができる準備が整う

**重要：** 今日は「理解する」ことが目標です。実際の操作は明日行います！

---

## 🤔 1. なぜDifyでDockerが必要なのか？

### 1.1 Difyローカル版の構成

Difyローカル版は、実は**複数のソフトウェアの集合体**です：

```
Difyアプリケーション
├── Webサーバー（フロントエンド）
├── APIサーバー（バックエンド）
├── データベース（PostgreSQL）
├── Redis（キャッシュ）
├── Nginx（プロキシサーバー）
└── その他の補助サービス
```

### 1.2 従来の問題

**もしDockerがなかったら...**
- 各ソフトウェアを個別にインストール
- バージョン管理が複雑
- 環境による動作の違い
- セットアップに数日必要

**Dockerがあることで...**
- ワンクリックで全て起動
- 環境の統一が可能
- 簡単に削除・再構築
- 数分でセットアップ完了

---

## 📦 2. Dockerとは何か？

### 2.1 身近な例で理解する

#### 引っ越しの荷造りに例えると...

**従来の方法（Docker以前）**
- 服、本、食器をバラバラに梱包
- 引っ越し先で一つずつ配置
- 元の配置を再現するのが困難

**Dockerの方法**
- 部屋ごとまるっとコンテナに梱包
- 引っ越し先でコンテナを開けば完了
- どこでも同じ環境を再現

### 2.2 技術的な定義

**Docker**は「**コンテナ仮想化技術**」です。

#### コンテナとは？
- アプリケーションとその実行環境を**まとめて梱包**したもの
- どの環境でも**同じように動作**する
- **軽量**で起動が早い

#### 仮想マシンとの違い

| 項目 | 仮想マシン | Docker コンテナ |
|------|------------|-----------------|
| **重さ** | 重い（GB単位） | 軽い（MB単位） |
| **起動時間** | 数分 | 数秒 |
| **リソース** | 多く消費 | 効率的 |
| **用途** | 完全分離 | アプリケーション実行 |

### 2.3 Dockerの基本構成要素

#### Dockerイメージ
- アプリケーションの**設計図**
- 一度作れば何度でも使用可能
- Docker Hubで共有される

#### Dockerコンテナ
- イメージから作られる**実際の実行環境**
- 複数のコンテナを同時実行可能
- 停止・削除が簡単

#### Dockerfile
- イメージの**作り方を記述**したファイル
- レシピのような役割
- テキストファイルで管理

---

## 🚢 3. Kubernetesとは何か？

### 3.1 身近な例で理解する

#### オーケストラの指揮者に例えると...

**Docker**：各楽器の演奏者
- バイオリン、ピアノ、ドラムなど（個別のコンテナ）
- それぞれは素晴らしい演奏ができる

**Kubernetes**：指揮者
- 全体の**調和**を管理
- 演奏者の**配置**を決定
- **トラブル時の対応**を指示

### 3.2 技術的な定義

**Kubernetes**（クーバネティス、K8s）は「**コンテナオーケストレーションツール**」です。

#### 主な機能
- **複数コンテナの管理**
- **負荷分散**
- **自動回復**（障害時の復旧）
- **スケーリング**（規模の拡大・縮小）

### 3.3 DifyでのKubernetesの役割

#### 小規模利用（今回のハンズオン）
- Docker Composeで十分
- Kubernetesは**将来の拡張**のための知識

#### 大規模利用（本格運用）
- 複数サーバーでの運用
- 高可用性の確保
- 自動的な負荷調整

---

## 🛠️ 4. Difyでよく使う用語集

### 4.1 Docker関連用語

#### 基本用語
- **Image（イメージ）**：アプリの設計図
- **Container（コンテナ）**：実際に動くアプリ
- **Registry（レジストリ）**：イメージの保管庫
- **Docker Hub**：公式のレジストリサービス

#### 操作用語  
- **Pull（プル）**：イメージをダウンロード
- **Run（ラン）**：コンテナを起動
- **Stop（ストップ）**：コンテナを停止
- **Remove（リムーブ）**：コンテナを削除

#### 構成用語
- **Port（ポート）**：アプリへのアクセス口
- **Volume（ボリューム）**：データの保存場所
- **Network（ネットワーク）**：コンテナ間の通信

### 4.2 Docker Compose用語

#### Docker Composeとは？
複数のコンテナを**まとめて管理**するツール

#### 重要な用語
- **docker-compose.yml**：構成設定ファイル
- **Service（サービス）**：各コンテナの定義
- **Up（アップ）**：全サービス起動
- **Down（ダウン）**：全サービス停止

### 4.3 実際のDify構成例

```yaml
# docker-compose.ymlのイメージ
services:
  # Webフロントエンド
  web:
    image: dify-web
    ports:
      - "80:3000"
  
  # APIサーバー  
  api:
    image: dify-api
    ports:
      - "5001:5001"
      
  # データベース
  db:
    image: postgres:15
    ports:
      - "5432:5432"
```

**読み方：**
- `web`：Webサーバーのサービス名
- `image: dify-web`：使用するDockerイメージ
- `ports: "80:3000"`：外部ポート80を内部ポート3000に接続

---

## 💻 5. Docker Desktopの基本

### 5.1 Docker Desktopとは？

Windows/Mac用の**Docker管理ツール**です。

#### 主な機能
- **GUI**でのコンテナ管理
- **ログ確認**
- **リソース監視**
- **設定管理**

### 5.2 画面の見方（予習）

明日実際に操作しますが、事前に画面構成を確認しましょう。

#### メイン画面の要素
- **Containers**：実行中のコンテナ一覧
- **Images**：ダウンロード済みイメージ一覧  
- **Volumes**：データ保存領域一覧
- **Settings**：各種設定

#### よく使う操作
- **▶️ Start**：コンテナ開始
- **⏹️ Stop**：コンテナ停止
- **🗑️ Delete**：コンテナ削除
- **📋 Logs**：ログ確認

---

## 🎯 6. 明日のハンズオンで行うこと

### 6.1 Dify構築の流れ

#### Step 1: 環境準備
- Docker Desktopの起動確認
- 必要ファイルのダウンロード
- システム要件の最終確認

#### Step 2: Difyのダウンロード
```bash
# GitHubからDifyをクローン
git clone https://github.com/langgenius/dify.git
cd dify/docker
```

#### Step 3: 環境設定
- 設定ファイルの編集
- データベース設定
- ポート番号の調整

#### Step 4: 起動
```bash
# Docker Composeで一括起動
docker-compose up -d
```

#### Step 5: 動作確認
- ブラウザでDifyにアクセス
- 基本機能の動作確認
- ログの確認方法

### 6.2 トラブルシューティング準備

明日起こりがちなトラブル：
- **ポートが使用中**：他のアプリとの競合
- **メモリ不足**：Docker Desktopの設定調整
- **起動に時間がかかる**：初回は正常
- **ブラウザでアクセスできない**：ポート設定確認

---

## 🔍 7. よくある質問と回答

### Q1: DockerとVMware/VirtualBoxの違いは？
**A:** 
- **Docker**：アプリケーション実行に特化、軽量
- **VMware等**：完全なOS仮想化、重い

### Q2: Dockerは無料？
**A:** 
- **個人・小規模企業**：無料
- **大企業**：有料プランあり（Dify利用なら通常問題なし）

### Q3: コンテナを削除したらデータは消える？
**A:** 
- **コンテナ内データ**：消える
- **Volume設定したデータ**：残る（Difyは設定済み）

### Q4: Kubernetesは必ず必要？
**A:** 
- **今回のハンズオン**：不要（Docker Composeのみ）
- **本格運用**：規模により検討

### Q5: エラーが出たらどうする？
**A:** 
1. **ログを確認**
2. **ポート番号をチェック**
3. **Docker Desktopを再起動**
4. **講師に質問**

---

## 📚 8. 自宅での予習・復習

### 8.1 推奨する予習内容

#### Docker Desktop インストール
- [公式サイト](https://www.docker.com/products/docker-desktop/)からダウンロード
- インストール後、**起動確認**まで

#### 基本コマンドの確認
```bash
# Dockerのバージョン確認
docker --version

# 動作テスト
docker run hello-world
```

### 8.2 参考資料

#### 公式ドキュメント
- [Docker公式チュートリアル](https://docs.docker.com/get-started/)
- [Docker Compose ガイド](https://docs.docker.com/compose/)

#### 学習リソース
- Docker公式のPlay with Docker
- YouTubeの初心者向け解説動画
- Udemyのハンズオン講座

---

## 🚀 9. 明日への準備チェックリスト

### 9.1 技術的準備

- [ ] **Docker Desktop**のインストール完了
- [ ] **起動確認**ができている
- [ ] **コマンドライン**の基本操作に慣れている
- [ ] **テキストエディタ**（VS Code等）の準備

### 9.2 知識的準備

- [ ] **Dockerの基本概念**を理解している
- [ ] **コンテナとイメージの違い**がわかる
- [ ] **Docker Composeの役割**を把握している
- [ ] **基本用語**を覚えている

### 9.3 環境的準備

- [ ] **安定したインターネット接続**
- [ ] **十分な作業時間**（3-4時間）の確保
- [ ] **メモリ8GB以上**の確認
- [ ] **ディスク容量10GB以上**の確保

---

## ✅ 1日目午後まとめ

**今日学んだこと**
- DockerはDifyの複数サービスをまとめて管理するツール
- コンテナ仮想化により環境の統一と簡単な管理を実現
- Docker Composeで複数コンテナを一括操作
- 基本用語と概念を理解

**明日への準備**
- Docker Desktopの事前インストール
- 基本操作の心構えができている
- トラブル時の対処法を把握

**重要なポイント**
- 今日は「理解」が目標、実操作は明日
- わからないことがあっても明日のハンズオンで解決
- 基本概念さえ理解していれば問題なし

明日のハンズオンで実際にDifyを動かしましょう！